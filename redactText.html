<!doctype html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="-1">
    <title>–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤</title>
    <link rel="stylesheet" href="css/reset.css" type="text/css">
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css" />
    <link rel="stylesheet" href="css/style.css" type="text/css">
    <link rel="stylesheet" href="css/redactText.css" type="text/css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

</head>

<body>
    <div class="wrapper">
        <header class="header header2" id="myTab" role="tablist">
            <div class="text2" role="tabpanel" aria-labelledby="text-tab">
                <div class="form-text-filter">
                    <div class="ftf-box">
                        <select name="text_project" id="text_pr_list" class="form-control">
                            <option value='0' checked="checked">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç</option>
                        </select>
                    </div>
                    <div class="ftf-box">
                        <select name="text_project" id="mailing_type" class="form-control">
                            <option value='0' checked="checked">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ä–∞—Å—Å—ã–ª–∫–∏</option>
                        </select>
                    </div>
                    <div class="ftf-box">
                        <div class="calendar-box"><input class="calendar" type="date" name="calendar"></div>
                    </div>
                    <div class="ftf-box" style="justify-content: start !important;flex-direction: column;">

                        <a href="#" id="createMailingTextBtn" class="btn gen-templates">–í—ã–±—Ä–∞—Ç—å</a>
                        <a href="#" id="addText" class="btn" style="margin-top:10px;">–¥–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç</a>
                    </div>
                </div>
            </div>
        </header>
        <main>
            <section>
                <div class="container-for-text"></div>
                <div class="ftf-box" style="justify-content:start !important;margin:20px 60px;">
                    <a href="index.php" class="btn gen-templates">–ù–∞ –≥–ª–∞–≤–Ω—É—é </a>
                </div>
            </section>
            <a href="#" class="btn gen-templates redact-btn" id="saveTextBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</a>
        </main>
        <div class="save-text-container">
            <p>–¢–µ–∫—Å—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è üëç</p>
        </div>
    </div>

</body>
<script type="application/json" src="javascript/projects.JSON"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
<script type="text/javascript">
    $.ajax({
        cache: false,
    });

    function sliderFunction() {
        $('.one-time').slick({
            dots: true,
            infinite: true,
            speed: 300,
            slidesToShow: 1,
            adaptiveHeight: true
        });
    }
    let textPrList = document.querySelector("#text_pr_list");
    let mailingType = document.querySelector("#mailing_type");
    let redactBtn = document.querySelector(".redact-btn");
    let containerForText = document.querySelector(".container-for-text");
    window.onscroll = function (e) {
        redactBtn.style.position = "sticky";
        redactBtn.style.bottom = "20px";
        redactBtn.style.left = "80%";
    }
    var way = "texts/";

    const sendTextIdtArr = [];

    function readTextFile(file, callback) {

        var rawFile = new XMLHttpRequest();
        rawFile.overrideMimeType("javascript/projects.json");
        rawFile.open("GET", file, true);
        rawFile.onreadystatechange = function () {
            if (rawFile.readyState === 4 && rawFile.status == "200") {
                callback(rawFile.responseText);
            }
        }
        rawFile.setRequestHeader("Cache-Control", "no-cache");
        rawFile.send(null);
    }
    readTextFile("javascript/projects.json", function (text) {
        var data = JSON.parse(text);
        // –¥–æ—Å—Ç–∞—ë–º –Ω–∞–∑–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤
        for (let i = 0; i < data.length; i++) {
            const option = document.createElement('option');
            option.textContent = data[i].name;
            textPrList.appendChild(option);
        }

        function deleteOption() {
            while (mailingType.firstChild) {
                mailingType.removeChild(mailingType.firstChild);
            };
            mailingType.innerHTML = `
            <option value='0'>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ä–∞—Å—Å—ã–ª–∫–∏</option>
            `;
        }

        // —Ç–∏–ø —Ä–∞–∑–º–µ—Ç–∫–∏ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞
        function mailingTypeBtn(way) {
            let textPrListValue = textPrList.value;
            for (let i = 0; i < data.length; i++) {
                if (textPrListValue === data[i].name && mailingType.length <= data[i].type.length) {
                    let projectId = "projectId=" + data[i].id;
                    sendTextIdtArr.push(projectId);
                    for (let j = 0; j < data[i].type.length; j++) {
                        let option2 = document.createElement('option');
                        option2.textContent = data[i].type[j][0];
                        mailingType.appendChild(option2);
                    }
                }
            }
            way = "texts/" + textPrList.value.replace(/\s+/g, '') + "/" + mailingType.value.replace(/\s+/g,
                '') + "/textsData.json";
            textPrList.addEventListener("click", deleteOption);

            function updateMarkup() {

                while (containerForText.firstChild) {
                    containerForText.removeChild(containerForText.firstChild);
                }
            };
            updateMarkup();
            return way;
        }
        mailingType.addEventListener("click", mailingTypeBtn);

    });

    function addText() {
        let subject = document.querySelectorAll(".subject");
        let text = document.getElementsByName("text");
        let btnInput = document.querySelectorAll(".text-box2 input");
        for (let i = 0; i < subject.length; i++) {
            subject[i].value = "–ü—Ä–∏—è—Ç–Ω–æ–≥–æ —É–∏–∫–µ–Ω–¥–∞ –∏ —Å–∞–º—ã—Ö –ø–æ–∑–∏—Ç–∏–≤–Ω—ã—Ö —ç–º–æ—Ü–∏–π!"
        }
        for (let i = 0; i < text.length; i++) {
            text[i].value =
                "{username}, –º—ã —Ö–æ—Ç–∏–º, —á—Ç–æ–±—ã –í—ã —á–∞—â–µ —É–ª—ã–±–∞–ª–∏—Å—å. –ü–æ—ç—Ç–æ–º—É –ø—Ä–∏–≥–æ—Ç–æ–≤–∏–ª–∏ –¥–ª—è –í–∞—Å –ø—Ä–∏—è—Ç–Ω—ã–π –ø—Ä–µ–∑–µ–Ω—Ç ‚Äî –ø–∞–∫–µ—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤."
        }
        for (let i = 0; i < btnInput.length; i++) {
            btnInput[i].value = "Play"
        }
    }
    document.querySelector("#addText").addEventListener("click", addText);
</script>
<script type="application/json" src=`${way}`></script>
<script type="text/javascript">
    $(document).ready(function () {
        $.getScript("javascript/redactText.js", function (data, textStatus, jqxhr) {
            console.log("done")
        });
    });
</script>
</html>